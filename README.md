# Проектная работа "Веб-ларек"

_Интернет-магазин на HTML/SCSS/TS по шаблону MVP_

## Технологии

- HTML, SCSS
- TypeScript
- Webpack
- MVP-подход (Model–View–Presenter)

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

### Оглавление

- [Архитектура MVP](#архитектура-mvp)
- [Описание данных](#описание-данных)
- [Типовой сценарий пользователя](#типовой-сценарий-пользователя)
- [Служебные модули](#служебные-модули)
- [Установка и запуск](#установка-и-запуск)
- [Сборка](#сборка)

Проект реализован по шаблону MVP (Model–View–Presenter), который обеспечивает чёткое разделение ответственности между логикой, представлением и данными.

## Архитектура MVP

Слой данных, логики и отображения разделены на три части:

- **Model** — отвечает за хранение и обработку данных, работу с API.
- **View** — отвечает за визуальное отображение и взаимодействие с пользователем.
- **Presenter** — связующее звено между Model и View, обрабатывает действия пользователя и обновляет представление.

---

### Model

Слой данных. Отвечает за:

- хранение и управление данными (список товаров, содержимое корзины, сведения о заказе);
- логику добавления, удаления, подсчёта итоговой стоимости и валидации данных.

## Основные классы:

- ### ProductModel

  **Назначение**:
  Отвечает за хранение и предоставление списка товаров.

  **Конструктор**:
  constructor(products: Product[])
  **Поля**:

  - products: Product[] — массив объектов товаров. Хранит актуальные данные о доступных товарах.

  **Методы**:

  - getAll(): Product[] — возвращает полный список товаров.
  - getById(id: string): Product | undefined — возвращает товар по идентификатору, если найден.

- ### CartModel

  Назначение:
  Управляет содержимым корзины: добавление, удаление, подсчёт суммы, очистка.

  Конструктор:
  constructor()
  Поля:

  - items: CartItem[] — массив товаров, добавленных в корзину. Каждый элемент содержит ссылку на товар и его количество.
    Методы:
  - getAll(): Product[] — возвращает полный список товаров.
  - getById(id: string): Product | undefined — возвращает товар по идентификатору, если найден.

- OrderModel: хранит информацию о заказе, отправляет заказ на сервер.

---

### View

Слой отображения. Отвечает только за визуальное представление и взаимодействие с пользователем.
Механизм взаимодействия:

1. View сообщает Presenter о действиях пользователя (нажатие, ввод данных).
2. Presenter обновляет Model.
3. Model сообщает Presenter об изменениях.
4. Presenter обновляет View.

Основные компоненты:

- ProductCardView: Карточка товара — отображение информации и реакция на клики.
- ModalView: Универсальное модальное окно.
- CartView: Отображает модальное окно корзины, список товаров с кнопками удаления и общей стоимостью, а также кнопку для оформления заказа.
- OrderView: Модальное окно оформления заказа (адрес, способ оплаты, контакты).
- SuccessView: финальный экран подтверждения заказа.

---

### Presenter

Связующее звено между Model и View. Обрабатывает действия пользователя, вызывает соответствующие методы моделей, обновляет представление.
Основные презентеры:

- ProductListPresenter: управляет загрузкой товаров и отрисовкой карточек.
- CartPresenter: реагирует на добавление и удаление товаров, формирует корзину.
- OrderPresenter: собирает данные заказа, валидирует, отправляет на сервер.
- ModalPresenter: управляет логикой отображения модальных окон.

## Пример сценария: добавление товара в корзину

1. **Пользователь видит список товаров**
   На экране отображаются карточки товаров. Это делает View, которая получает данные от Presenter.
2. **Пользователь нажимает на товар**
   View сообщает об этом действии Presenter'у.
   Presenter узнаёт, какой товар был выбран, и решает, что нужно показать подробности.
3. **Открывается модальное окно с товаром**
   Presenter говорит View: «Покажи окно с информацией о товаре».
4. **Пользователь нажимает «Добавить в корзину»**
   View снова сообщает Presenter'у: пользователь хочет добавить товар.
5. **Presenter передаёт это в модель**
   Presenter говорит Model: «Добавь товар в корзину».
6. **Model обновляет корзину**
   Модель добавляет товар и сообщает, что корзина изменилась.
7. **Presenter получает сигнал от модели**
   Presenter узнаёт, что корзина обновлена, и решает, что нужно обновить интерфейс.
8. **Обновляется корзина в интерфейсе**
   Presenter сообщает View: «Покажи, что в корзине теперь есть новый товар».
9. **Пользователь открывает корзину**
   View сообщает об этом Presenter'у.
   Presenter говорит View: «Покажи окно оформления заказа».
10. **На экране отображается оформление**
    View показывает финальный экран с заказом — всё готово для подтверждения.

---

## Описание данных:

1. ### Товар (Product) — объект
   Карточки товаров, отображаемые на главной странице и в модальном окне.
   Содержит:

- id — уникальный идентификатор,
- title — название,
- description — описание,
- image — путь к изображению,
- category — категория (например, "другое", "кнопка"),
- price — цена (может быть null, если товар недоступен).

2. ### Список товаров (ProductList) — коллекция
   Массив объектов Product, который мы получаем с сервера.
   Содержит:

- total — общее количество товаров,
- items — массив Product[].

3. ### Позиция в корзине (CartItem) — объект

   Один товар, добавленный в корзину.
   Содержит:

- product — ссылка на Product,
- price — цена (копируется из товара на момент добавления),
- title — название (тоже копируется).

4. ### Корзина (Cart) — коллекция
   Список товаров, добавленных в корзину.
   Содержит:

- items — массив объектов CartItem.

5. ### Заказ (Order) — объект
   Информация, которую мы отправляем на сервер при оформлении заказа.
   Содержит:

- items — массив Product.id[],
- total — сумма заказа,
- address — адрес доставки (обязательное поле),
- payment — способ оплаты ("Онлайн" или "При получении"),
- email — email (валидируется, обязательное поле),
- phone — телефон (валидируется, обязательное поле).

6. ### Ответ на заказ (OrderResponse) — объект

   Ответ от сервера после оформления заказа.
   Содержит:
   id — идентификатор заказа,
   total — подтверждённая сумма.

7. ### Ошибки (Errors) — объекты
   Могут приходить от сервера или показываться пользователю.
   Типовые ошибки:

- "Не указан адрес" - (No address),
- "Неверная сумма заказа" - (Wrong total),
- "Товар не найден" - (Product not found).

---

## Типовой сценарий пользователя:

1. Просмотр товаров

- Пользователь заходит на главную страницу.
- Ему показывается список карточек товаров с названием, изображением и ценой и категорией.
- Пользователь кликает на карточку товара, чтобы посмотреть подробности.

2. Просмотр информации о товаре

- Открывается модальное окно с названием, описанием, картинкой и ценой товара и категорией товара.
- Если цена указана — есть кнопка «В корзину», иначе — «Недоступно».
- Пользователь может закрыть окно, нажав на крестик.

3. Добавление товара в корзину

- Пользователь нажимает кнопку «В корзину».
- Товар добавляется в корзину.
- Модальное окно закрывается.

4. Просмотр корзины

- Пользователь нажимает на иконку корзины в интерфейсе.
- Открывается модальное окно корзины со списком добавленных товаров.
- Для каждого товара отображаются название, цена, кнопка «Удалить».
- Пользователь может удалить товар или закрыть окно.
- Пользователь может увидеть суммарную стоимость продуктов что лежат в корзине

5. Оформление заказа — шаг 1: Адрес и способ оплаты

- Пользователь нажимает кнопку «Оформить заказ» в корзине.
- Открывается модальное окно с выбором способа оплаты («Онлайн» или «При получении») и полем для ввода адреса доставки.
- Пользователь вводит адрес и выбирает способ оплаты.
- Нажимает кнопку «Далее» или закрывает окно.

6. Оформление заказа — шаг 2: Контактные данные

- Пользователь вводит email и телефон (с простой валидацией).
- Нажимает кнопку «Оплатить и оформить заказ».

7. Подтверждение заказа

- Показывается окно с сообщением «Заказ оформлен» и итоговой суммой.
- Есть кнопки: закрыть окно и «За новыми покупками» (возврат на главную страницу).

---

## Служебные модули

1. API (src/components/api.ts) - Работа с сервером
   Этот файл отвечает за отправку и получение данных с сервера.

- Когда тебе нужно получить список товаров, мы вызываем метод get.
- Когда ты хочешь отправить заказ, мы вызываем метод post.

### Методы:

- protected handleResponse(response: Response): Promise

1. Что делает: проверяет, всё ли прошло хорошо. Если да — возвращает JSON, если ошибка — выкидывает её.
2. Параметры: response — ответ сервера.
3. Используется внутри get и post.

- get(uri: string)

1. Что делает: отправляет GET-запрос на сервер (например, получить список товаров).
2. Параметры: uri — часть адреса (например, /products).
3. Возвращает: промис с ответом от сервера (JSON-данные).

- post(uri: string, data: object, method: ApiPostMethods = 'POST')

1. Что делает: отправляет POST, PUT или DELETE-запрос.
2. Параметры:
   - uri — путь запроса (например, /order);
   - data — объект с данными (например, заказ);
   - method — метод запроса (по умолчанию POST).
3. Возвращает: промис с ответом от сервера (например, подтверждение заказа).

---

EVENTS (src/components/events.ts) - События между частями приложения
Этот файл нужен, чтобы разные части программы могли "общаться" друг с другом.

Например:

1. Пользователь нажимает "в корзину" на карточке товара
   Событие: product:add

Что происходит:

- Товар добавляется в модель корзины (CartModel)
- Обновляется отображение количества товаров

или

2. Пользователь открывает корзину
   Событие: cart:open

Что происходит:

- Показывается модальное окно с содержимым корзины
- Презентер запрашивает данные у CartModel и передаёт их во View

### Методы:

- on(eventName: string | RegExp, callback: (data) => void)

1. Что делает: подписывает обработчик на событие.
2. Параметры: eventName — имя события (например, 'cart:add'); callback — что делать, когда событие произойдёт.
3. Возвращает: ничего не возвращает (void). Просто сохраняет обработчик в списке.

- emit(eventName: string, data?: object)

1. Что делает: вызывает событие (всем, кто на него подписан, приходит сигнал).
2. Параметры: eventName — имя события; data — любые данные, которые нужно передать (необязательно).
3. Возвращает: ничего не возвращает (void). Все подписчики получают data, но emit ничего не возвращает.

- off(eventName: string | RegExp, callback: Function)

1. Что делает: удаляет обработчик (перестаёт слушать событие).
2. Параметры: eventName — имя события; callback — тот же обработчик, который вы передавали в on.
3. Возвращает: ничего не возвращает (void). Просто удаляет и всё.

- onAll(callback: (event) => void)

1. Что делает: подписывает на все события сразу.
2. Параметры: callback — функция, которая будет вызываться при любом событии. В параметрах: eventName и data.
3. Возвращает: ничего не возвращает (void).

- offAll()

1. Что делает: удаляет всех слушателей со всех событий.
2. Параметры: нет.
3. Возвращает: ничего не возвращает (void).

- trigger(eventName: string, context?: object): (data) => void

1. Что делает: создаёт готовую функцию, которая вызывает событие с заранее заданным контекстом.
2. Параметры: eventName — имя события; context — дополнительные данные, которые будут добавлены к data.
3. Возвращает: функцию, которую можно вызвать позже и она вызовет emit.

---

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```
