# Проектная работа "Веб-ларек"

_Интернет-магазин на HTML/SCSS/TS по шаблону MVP_

## Технологии

- HTML, SCSS
- TypeScript
- Webpack
- MVP-подход (Model–View–Presenter)

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

### Оглавление

- [Архитектура MVP](#архитектура-mvp)
- [Описание данных](#описание-данных)
- [Типовой сценарий пользователя](#типовой-сценарий-пользователя)
- [Служебные модули](#служебные-модули)
- [Установка и запуск](#установка-и-запуск)
- [Сборка](#сборка)

Проект реализован по шаблону MVP (Model–View–Presenter), который обеспечивает чёткое разделение ответственности между логикой, представлением и данными.

## Архитектура MVP

Слой данных, логики и отображения разделены на три части:

- **Model** — отвечает за хранение и обработку данных.
- **View** — отвечает за визуальное отображение и взаимодействие с пользователем.
- **Presenter** — связующее звено между Model и View, обрабатывает действия пользователя и обновляет представление.

---

### Model

Слой данных. Отвечает за:

- хранение и управление данными (список товаров, содержимое корзины, сведения о заказе);
- логику добавления, удаления, подсчёта итоговой стоимости и валидации данных.

## Основные классы:

- ### ProductModel

  **Назначение**:
  Отвечает за хранение и предоставление списка товаров.

  **Конструктор**:

  constructor(products: Product[])
  Принимает массив объектов Product, представляющих список товаров, доступных пользователю.
  **Поля**:

  - products: Product[] — массив объектов товаров. Хранит актуальные данные о доступных товарах.

  **Методы**:

  - getAll(): Product[] — возвращает полный список товаров.
  - getById(id: string): Product | undefined — Принимает строку id — идентификатор товара. Возвращает объект товара, если он найден, или undefined, если нет

- ### CartModel

  **Назначение**:
  Класс управляет содержимым корзины: добавляет и удаляет товары, рассчитывает итоговую сумму и позволяет очищать корзину.

  **Конструктор**:

  constructor(items?: IProduct[])
  Может принимать начальный массив товаров типа IProduct[]. По умолчанию создаёт пустую корзину.
  **Поля**:

  - items: IProduct[] — массив товаров в корзине. По умолчанию пустой.

  **Методы**:

  - getItems(): IProduct[] — возвращает текущий список товаров в корзине.
  - addProduct(product: IProduct): void — добавляет товар в корзину.
  - removeProduct(productId: ProductId): void — удаляет товар из корзины по идентификатору.
  - clear(): void — очищает данные заказа, сбрасывая поля в значения по умолчанию.
  - getTotal(): number — возвращает суммарную стоимость товаров в корзине (игнорируя товары с ценой null).

- ### OrderModel

  **Назначение**:
  Хранит информацию о текущем заказе, управляет данными заказа и их валидацией.

  **Конструктор**:

  constructor(order: IOrder)

  **Поля**:

  - order: IOrder — объект с данными заказа (список товаров, адрес, способ оплаты, контактная информация).

  **Методы**:

  - getOrder(): IOrder — возвращает текущие данные заказа.
  - setOrder(order: IOrder): void — обновляет данные заказа.
  - validate(): boolean — проверяет корректность данных заказа (например, заполнены ли адрес и email, совпадает ли сумма заказа).
  - clear(): void — очищает данные заказа, сбрасывая поля в значения по умолчанию.

---

### View

Слой отображения. Отвечает только за визуальное представление и взаимодействие с пользователем.
Механизм взаимодействия:

1. View сообщает Presenter о действиях пользователя (нажатие, ввод данных).
2. Presenter обновляет Model.
3. Model сообщает Presenter об изменениях.
4. Presenter обновляет View.

## Основные классы:

- ### MainView

  **Назначение**:
  Отвечает за отображение основной страницы магазина: список товаров и кнопка корзины в шапке.

  **Конструктор**:

  constructor(container: HTMLElement, headerElement: HTMLElement)

  **Поля**:

  - container: HTMLElement — контейнер для отображения каталога товаров.
  - headerElement: HTMLElement — элемент шапки, в котором расположена кнопка корзины.

  **Методы**:

  - renderProductList(products: IProduct[]): void — отображает список товаров, используя ProductCardView для каждого.
  - updateCartCounter(count: number): void — обновляет счётчик товаров на кнопке корзины.
  - bindEvents(): void — навешивает обработчики на кнопку корзины.

- ### ProductCardView

  **Назначение**:
  Отображает карточку товара с информацией (название, изображение, цена, категория) и реагирует на действия пользователя, например, клики по кнопке «Добавить в корзину».

  **Конструктор**:

  constructor(product: IProduct, container: HTMLElement)

  **Поля**:

  - product: IProduct — данные товара для отображения.
  - container: HTMLElement — контейнер для рендера карточки.

  **Методы**:

  - render(): void — отрисовывает карточку товара в контейнере.
  - bindEvents(): void — навешивает обработчики событий (например, клик по кнопке).

- ### ModalView

  **Назначение**:
  Универсальное модальное окно с базовой логикой открытия и закрытия.

  **Конструктор**:

  constructor(modalElement: HTMLElement)

  **Поля**:

  - modalElement: HTMLElement — корневой элемент модального окна.

  **Методы**:

  - open(): void — открывает модальное окно.
  - close(): void — закрывает модальное окно.
  - bindEvents(): void — навешивает обработчики на кнопки закрытия.

- ### CartView

  **Назначение**:
  Отображает содержимое корзины: список товаров, кнопки удаления, итоговую сумму и кнопку для перехода к оформлению заказа.

  **Конструктор**:

  constructor(container: HTMLElement)

  **Поля**:

  - container: HTMLElement — элемент, куда рендерится корзина.

  **Методы**:

  - render(items: IProduct[], total: number): void — отображает список товаров и итог.
  - bindEvents(): void — обрабатывает клики по кнопкам удаления и оформление заказа.

- ### FormView (базовый класс)

  **Назначение**:
  Обеспечивает общий функционал для форм: рендеринг, валидация, навешивание событий.

  **Конструктор**:

  constructor(container: HTMLElement)

  **Поля**:

  - container: HTMLElement — элемент, в котором рендерится форма.

  **Методы**:

  - render(data: object): void — отображает форму с переданными данными.
  - bindEvents(): void — навешивает обработчики событий формы.
  - validate(): boolean — проверяет корректность введённых данных.

- ### OrderAddressView extends FormView

  **Назначение**
  Форма ввода адреса доставки и выбора способа оплаты (первый шаг оформления заказа).

  **Конструктор**:
  constructor(container: HTMLElement)
  **Поля**: container: HTMLElement — элемент, в котором рендерится форма.
  **Методы**:

  - render(data: IOrder): void — отрисовывает форму с полями "адрес" и "оплата".
  - bindEvents(): void — навешивает обработчики событий (ввод, выбор).
  - validate(): boolean — проверяет заполненность адреса и выбранный способ оплаты.

- ### OrderContactsView extends FormView

  **Назначение**
  Форма ввода контактных данных: емейл и телефон (второй шаг оформления заказа).

  **Конструктор**:
  constructor(container: HTMLElement)
  **Поля**: container: HTMLElement — элемент, в котором рендерится форма.
  **Методы**:

  - render(data: IOrder): void — отрисовывает форму с полями "телефон" и "емейл".
  - bindEvents(): void — навешивает обработчики событий (ввод, отправка).
  - validate(): boolean — проверяет корректность емейл и телефон

- ### SuccessView

  **Назначение**
  Отображает финальный экран подтверждения заказа с суммой и кнопкой для начала новых покупок.

  **Конструктор**:
  constructor(container: HTMLElement)
  **Поля**:

  - container: HTMLElement — элемент для рендера сообщения.

    **Методы**:

  - render(orderResponse: IOrderResponse): void — отображает сообщение об успешном заказе с суммой.
  - bindEvents(): void — навешивает обработчик на кнопку «Новые покупки», закрывающий окно и очищающий состояние.
  - close(): void — закрывает окно и сбрасывает состояние

---

### Presenter

Связующее звено между Model и View. Обрабатывает действия пользователя, вызывает соответствующие методы моделей, обновляет представление.
Основные презентеры:

- ### AppPresenter

  _Назначение_:
  Централизованно управляет взаимодействием пользователя с приложением. Обрабатывает загрузку товаров, изменения в корзине, оформление заказа и управление модальными окнами.

  _Конструктор_:
  constructor(productModel: ProductModel, cartModel: CartModel, view: View)

  _Поля_:
  productModel: ProductModel — модель с товарами
  cartModel: CartModel — модель корзины
  view: View — объект представления

  _Методы_:
  init(): void — инициализация, установка обработчиков и начальная загрузка данных
  handleAddToCart(productId: string): void — обработка добавления товара в корзину
  handleRemoveFromCart(productId: string): void — удаление товара из корзины
  handleCheckout(orderData: OrderData): Promise<void> — валидация и отправка заказа
  showModal(type: string): void — управление модальными окнами

## Пример сценария: добавление товара в корзину

Участвующие классы:

- AppPresenter — основной презентер
- MainView, ProductCardView, ModalView, CartView — представление
- ProductModel, CartModel — модели

Пользователь заходит на страницу и видит список товаров
→ AppPresenter.init() вызывает ProductModel.getAll(),
→ результат передаёт в MainView.renderProductList(products).
→ ProductCardView.render() отрисовывает каждую карточку.

Пользователь нажимает на карточку товара
→ ProductCardView.bindEvents() навешивает слушатель на клик по карточке.
→ При клике вызывает AppPresenter.showModal('productDetails').

Открывается модальное окно с товаром
→ AppPresenter.showModal('productDetails')
→ вызывает ModalView.open() и рендерит детали товара внутри модального окна.

Пользователь нажимает «В корзину»
→ Кнопка в модальном окне вызывает AppPresenter.handleAddToCart(productId)

Presenter вызывает метод модели CartModel
→ AppPresenter.handleAddToCart(productId)
→ вызывает ProductModel.getById(productId) → возвращает product
→ затем CartModel.addProduct(product)

Модель обновляет корзину
→ CartModel.addProduct() обновляет массив items.

Presenter получает результат и обновляет интерфейс
→ AppPresenter вызывает CartModel.getItems() и CartModel.getTotal()
→ затем передаёт данные в MainView.updateCartCounter(count)

Обновляется счётчик корзины на странице
→ MainView.updateCartCounter(count) обновляет отображение кнопки корзины в шапке.

Пользователь нажимает на кнопку корзины
→ MainView.bindEvents() вызывает AppPresenter.showModal('cart')

Открывается корзина с товарами
→ AppPresenter.showModal('cart')
→ вызывает CartModel.getItems() и CartModel.getTotal()
→ и передаёт в CartView.render(items, total), затем вызывает ModalView.open()

## Описание данных:

1. ### Товар (Product) — объект
   Карточки товаров, отображаемые на главной странице и в модальном окне.
   Содержит:

- id — уникальный идентификатор,
- title — название,
- description — описание,
- image — путь к изображению,
- category — категория (например, "другое", "кнопка"),
- price — цена (может быть null, если товар бесценный).

2. ### Список товаров (ProductList) — коллекция
   Массив объектов Product, который мы получаем с сервера.
   Содержит:

- total — общее количество товаров,
- items — массив Product[].

3. ### Позиция в корзине (CartItem) — объект

   Один товар, добавленный в корзину.
   Содержит:

- product — ссылка на Product,

4. ### Корзина (Cart) — коллекция
   Список товаров, добавленных в корзину.
   Содержит:

- items — массив объектов IProduct, каждый из которых представляет добавленный в корзину товар.

5. ### Заказ (Order) — объект
   Информация, которую мы отправляем на сервер при оформлении заказа.
   Содержит:

- items — массив Product.id[],
- total — сумма заказа,
- address — адрес доставки (обязательное поле),
- payment — способ оплаты ("Онлайн" или "При получении"),
- email — email (валидируется, обязательное поле),
- phone — телефон (валидируется, обязательное поле).

6. ### Ответ на заказ (OrderResponse) — объект

   Ответ от сервера после оформления заказа.
   Содержит:
   id — идентификатор заказа,
   total — подтверждённая сумма.

7. ### Ошибки (Errors) — объекты
   Могут приходить от сервера или показываться пользователю.
   Типовые ошибки:

- "Не указан адрес" - (No address),
- "Неверная сумма заказа" - (Wrong total),
- "Товар не найден" - (Product not found).

---

## Типовой сценарий пользователя:

1. Просмотр товаров

- Пользователь заходит на главную страницу.
- Ему показывается список карточек товаров с названием, изображением и ценой и категорией.
- Пользователь кликает на карточку товара, чтобы посмотреть подробности.

2. Просмотр информации о товаре

- Открывается модальное окно с названием, описанием, картинкой и ценой товара и категорией товара.
- Если цена указана — есть кнопка «В корзину», иначе — «Недоступно».
- Пользователь может закрыть окно, нажав на крестик.

3. Добавление товара в корзину

- Пользователь нажимает кнопку «В корзину».
- Товар добавляется в корзину.
- Модальное окно закрывается.

4. Просмотр корзины

- Пользователь нажимает на иконку корзины в интерфейсе.
- Открывается модальное окно корзины со списком добавленных товаров.
- Для каждого товара отображаются название, цена, кнопка «Удалить».
- Пользователь может удалить товар или закрыть окно.
- Пользователь может увидеть суммарную стоимость продуктов что лежат в корзине

5. Оформление заказа — шаг 1: Адрес и способ оплаты

- Пользователь нажимает кнопку «Оформить заказ» в корзине.
- Открывается модальное окно с выбором способа оплаты («Онлайн» или «При получении») и полем для ввода адреса доставки.
- Пользователь вводит адрес и выбирает способ оплаты.
- Нажимает кнопку «Далее» или закрывает окно.

6. Оформление заказа — шаг 2: Контактные данные

- Пользователь вводит email и телефон (с простой валидацией).
- Нажимает кнопку «Оплатить и оформить заказ».

7. Подтверждение заказа

- Показывается окно с сообщением «Заказ оформлен» и итоговой суммой.
- Есть кнопки: закрыть окно и «За новыми покупками» (возврат на главную страницу).

---

## Служебные модули

1. API (src/components/api.ts) - Работа с сервером
   **Назначение**:
   Базовый класс для работы с сервером. Отвечает за отправку запросов и обработку ответов.
   **Конструктор**:
   constructor(baseUrl: string, options: RequestInit = {})
   Принимает базовый URL сервера (например, https://larek-api.nomoreparties.co) и объект с дополнительными настройками запросов (заголовки, методы и т.п.). Сохраняет их в соответствующие поля.
   **Поля**:

- baseUrl: string — адрес сервера
- options: RequestInit — настройки запросов

**Методы**:

- protected handleResponse(response: Response): Promise<object>
  Проверяет ответ сервера.
  _Параметры_:
  response — объект ответа от сервера (Response)
  _Возвращает_:
  Промис с JSON-данными или ошибку, если статус ответа не OK.
- get(uri: string): Promise<object>
  Отправляет GET-запрос на сервер.
  _Параметры:_
  uri — часть пути запроса (например, /products)
  _Возвращает_:
  Промис с JSON-ответом от сервера.
- post(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise<object>
  Отправляет POST, PUT или DELETE-запрос с данными на сервер.
  _Параметры:_
  uri — путь запроса (например, /order)
  data — объект с данными (например, заказ)
  method — HTTP-метод (по умолчанию 'POST')
  _Возвращает:_
  Промис с JSON-ответом от сервера.

2. EVENTS (src/components/events.ts) - События между частями приложения
   **Назначение**:
   Позволяет разным частям приложения взаимодействовать друг с другом через события.
   **Конструктор**:
   constructor()
   Создаёт новый экземпляр EventEmitter. Инициализирует внутреннее хранилище событий.
   **Поля**:

- \_events: Map<string | RegExp, Set Fn> — коллекция всех подписок на события. Ключ — имя события (или шаблон), значение — множество функций-обработчиков.

**Методы**:

- on(eventName: string | RegExp, callback: (data) => void): void
  Подписывает функцию на событие.
  _Параметры_:
  eventName — имя события или регулярное выражение (например, 'cart:add')\
  callback — функция, вызываемая при срабатывании события
- emit(eventName: string, data?: object): void
  Вызывает событие и передаёт подписчикам данные.
  _Параметры_:
  eventName — имя события
  data — объект с данными (необязательный)
- off(eventName: string | RegExp, callback: Function): void
  Отписывает обработчик от события.
  _Параметры_:
  eventName — имя события или шаблон
  callback — функция, ранее переданная в on
- onAll(callback: (event: { eventName: string; data?: object }) => void): void
  Подписывает функцию на все события.
  Параметры:
  callback — функция, получающая имя события и переданные данные
- offAll(): void
  Удаляет всех слушателей со всех событий.
  Параметры:
  Нет
- trigger(eventName: string, context?: object): (data: object) => void
  Создаёт функцию, которая вызывает событие с добавлением контекста.
  _Параметры_:
  eventName — имя события
  context — данные, объединяемые с переданными при вызове
  _Возвращает_:
  Функцию, вызывающую emit(eventName, { ...context, ...data })

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```
